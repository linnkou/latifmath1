<script>
    // معالجة رفع الملفات
    document.getElementById('upload-form')?.addEventListener('submit', async function (e) {
        e.preventDefault();

        const token = localStorage.getItem('github-token');
        if (!token) {
            alert('يرجى تسجيل الدخول أولاً.');
            window.location.href = 'login.html'; // إعادة توجيه إلى صفحة تسجيل الدخول
            return;
        }

        const year = document.getElementById('year').value;
        const fileType = document.getElementById('file-type').value;
        const fileName = document.getElementById('file-name').value;
        const file = document.getElementById('file-upload').files[0];

        if (!file) {
            alert('يرجى اختيار ملف.');
            return;
        }

        if (!fileName) {
            alert('يرجى إدخال اسم الملف.');
            return;
        }

        const message = document.getElementById('message');
        message.textContent = 'جاري رفع الملف...';

        try {
            const downloadUrl = await uploadFileToGitHub(file, fileName, year, fileType, token);
            message.innerHTML = `تم رفع الملف بنجاح: <a href="${downloadUrl}" target="_blank">${fileName}</a>`;
            displayUploadedFiles(token); // تحديث قائمة الملفات بعد الرفع
        } catch (error) {
            console.error(error); // عرض تفاصيل الخطأ في الكونسول
            message.textContent = 'حدث خطأ أثناء رفع الملف: ' + error.message;
        }
    });

    // عرض الملفات عند تحميل الصفحة (إذا كان التوكن مخزنًا في localStorage)
    window.onload = () => {
        const token = localStorage.getItem('github-token');
        if (!token) {
            alert('يرجى تسجيل الدخول أولاً.');
            window.location.href = 'login.html'; // إعادة توجيه إلى صفحة تسجيل الدخول
        } else {
            document.getElementById('github-token').value = token;
            displayUploadedFiles(token);
        }
    };
</script>
